{% extends "butterflies/base.html" %}
{% load i18n %}
{% load static %}
{% load butterfly_extras butterfly_display query_utils %}
{% block title %}{% blocktrans %}Edit {{ model_name }} Table{% endblocktrans %}{% endblock %}
{% block header %}<img src="{% static 'butterflies/img/logo_ASA_curvas.jpg' %}" alt="ASA Logo" class="header-logo" style="height: 50px;">{% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static 'butterflies/css/utilities.css' %}">
<div class="d-flex align-items-center mb-3">
  <h2 class="mb-0">{% blocktrans %}Edit {{ model_name }} Table{% endblocktrans %}</h2>
  <div class="ml-3 text-muted" style="max-width: 400px;">
    <p class="m-0">{% trans "Enter specimen catalog number or range and add additional filters (optional)." %}</p>
  </div>
</div>

<div class="mb-3">
  <a href="{% url 'export_model_csv' model_name_internal %}" class="mr-2">{% trans "Export CSV" %}</a>
  <a href="{% url 'export_model_excel' model_name_internal %}" class="mr-2">{% trans "Export Excel" %}</a>
  
  {% load auth_tags %}
  {% if user.is_superuser or user|has_group:'Admin' %}
    <a href="{% url 'import_model' model_name_internal %}">{% trans "Import Data" %}</a>
    {% if model_name_internal == 'specimen' %}
      {% with bulk_delete_confirm_msg=_("This is a debug feature. Are you sure you want to proceed to the bulk delete page?") %}
        <a href="{% url 'debug_bulk_delete_specimen' %}" class="ml-3 text-danger"
           onclick="return confirm('{{ bulk_delete_confirm_msg }}')">
          {% trans "Debug Bulk Delete" %}
        </a>
      {% endwith %}
    {% endif %}
  {% endif %}
</div>

<div class="mb-4">
  <h3 class="mb-2">{% trans "Edit existing records" %}</h3>
  
  <!-- Standardized filter form -->
  {% include 'butterflies/includes/_filter_form.html' %}
</div>

{% if import_errors %}
<div class="alert alert-danger mb-4 p-3 rounded">
  <h4 class="mt-0 font-bold text-danger">{% trans "Import Errors" %}</h4>
  <p class="text-danger">{% trans "The following errors occurred during import:" %}</p>
  <ul class="mb-0 text-danger">
    {% for error in import_errors %}
      <li>{{ error }}</li>
    {% endfor %}
  </ul>
</div>
{% endif %}

{% include "butterflies/_table.html" with objects=objects fields=fields field_names=field_names request=request %}
<a href="{% url 'dynamic_create' model_name_internal %}">{% blocktrans %}Add New {{ model_name }}{% endblocktrans %}</a>
<a href="{% url 'report_table' %}">{% trans "Back to Report Table" %}</a>
{% endblock %}
