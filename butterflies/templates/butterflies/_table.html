{# _table.html - Reusable table and search row for any model #}

{% load i18n %}
{% load butterfly_extras butterfly_display %}
{% load static %}
{% load auth_tags %}

{# Include necessary CSS for the table #}
<link rel="stylesheet" href="{% static 'butterflies/css/table-styles.css' %}">
<link rel="stylesheet" href="{% static 'butterflies/css/pagination.css' %}">

<div class="table-wrapper">
<table class="concise-table">
    <tr>
        {% for field in fields %}
            <th>{{ field.verbose_name }}</th>
        {% endfor %}
    </tr>
    <tr>
        <form method="get">
        {% for field in fields %}
            <td>
                <input type="text" name="{{ field.name }}" value="{{ request.GET|get_search_value:field.name }}" placeholder="{% trans 'Search...' %}">
            </td>
        {% endfor %}
        <td>
            <button type="submit">{% trans 'Search' %}</button>
        </td>
        </form>
    </tr>
    {% for obj in objects %}
    <tr>
        {% for field in fields %}
            {% if forloop.first %}
                <td title="{{ obj|get_field_value:field.name|dot_if_none }}"><a href="{% url 'dynamic_detail' obj.model_name_internal obj.pk %}">{{ obj|get_field_value:field.name|dot_if_none }}</a></td>
            {% else %}
                <td title="{{ obj|get_field_value:field.name|dot_if_none }}">{{ obj|get_field_value:field.name|dot_if_none }}</td>
            {% endif %}
        {% endfor %}
        <td>
            <a href="{% url 'dynamic_edit' obj.model_name_internal obj.pk %}">{% trans 'Edit' %}</a>
            {% load auth_tags %}
            {% if user.is_superuser or user|has_group:'Admin' %}
            | <a href="{% url 'dynamic_delete' obj.model_name_internal obj.pk %}">{% trans 'Delete' %}</a>
            {% endif %}
        </td>
    </tr>
    {% empty %}
    <tr><td colspan="{{ fields|length }}">{% trans 'No records found.' %}</td></tr>
    {% endfor %}
</table>
</div>

{% if paginator %}
    {% include 'butterflies/_pagination.html' %}
{% endif %}
