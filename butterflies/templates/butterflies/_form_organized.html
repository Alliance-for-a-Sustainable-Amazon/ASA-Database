{# _form_organized.html - Organized form for specimen data with categories following Darwin Core standards #}
{% load butterfly_extras %}
<form method="post">
    {% csrf_token %}
    {% if form.non_field_errors %}
        <div class="error nonfield">{{ form.non_field_errors }}</div>
    {% endif %}
    {% if form.errors %}
        <div class="error summary">Please correct the errors below.</div>
    {% endif %}
    
    <!-- Enhanced CSS for organized form elements -->
    <style>
        /* Base styling for all inputs */
        input, select, textarea, .searchable-input {
            padding: 6px 8px;
            border: 1px solid #6b8e23; /* Olive green border */
            border-radius: 4px;
            font-size: 14px;
            min-width: 150px;
        }
        
        /* Specific styling for textareas */
        textarea {
            width: 100%;
            min-height: 80px;
            display: block;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus, .searchable-input:focus {
            outline: none;
            border-color: #8fbc8f; /* Sea green when focused */
            box-shadow: 0 0 3px rgba(143, 188, 143, 0.5);
        }
        
        /* Text field container for textarea fields */
        .text-field-container {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .text-field-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        /* Styling for textareas - using !important to override any conflicting styles */
        .text-field-container textarea {
            display: block !important;
            width: 100% !important;
            min-height: 80px !important;
            border: 1px solid #6b8e23 !important;
            padding: 8px !important;
            box-sizing: border-box !important;
            font-size: 14px !important;
            border-radius: 4px !important;
            background-color: #ffffff !important;
        }
        
        /* Category section styling */
        .category-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #d1e0bf;
            border-radius: 6px;
            background-color: #f9fbf7;
        }
        
        .category-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4f6228;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #d1e0bf;
        }
        
        /* Field section styling */
        .field-section {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 4px;
        }
        
        /* .field-section:hover {
            background-color: #f0f5e8;
        } */
        
        /* History section styling */
        .history-section {
            margin-bottom: 1em;
            padding: 0.5em;
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        /* Flex container for form sections */
        .flex-container {
            display: flex;
            gap: 10px;
            align-items: baseline;
            width: 100%;
        }
        
        /* Container styling */
        .date-container {
            flex: 0 0 220px; /* Fixed width for date fields */
        }
        
        .initials-container {
            flex: 0 0 150px; /* Fixed width for initials */
        }
        
        .description-container {
            flex: 1; /* Grow to fill available space */
            min-width: 200px;
        }
        
        /* Searchable dropdown styling */
        .searchable-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .searchable-input {
            width: 100%;
            cursor: pointer;
        }
        
        .searchable-dropdown {
            position: absolute;
            width: 100%;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            z-index: 1000;
            display: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .searchable-option {
            padding: 6px 10px;
            cursor: pointer;
        }
        
        .searchable-option:hover {
            background-color: #f0f8ff; /* Light blue on hover */
        }
        
        /* Form field error styling */
        .field-error, .error {
            color: #d32f2f;
            font-size: 12px;
            margin-top: 4px;
        }
        
        /* Toggle button for category sections */
        .category-toggle {
            background: none;
            border: none;
            color: #4f6228;
            cursor: pointer;
            float: right;
            font-size: 1rem;
        }
        
        /* Grid layout for form fields */
        .field-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }
    </style>

    <div id="form-info" class="form-info">
        {% load static %}
        <script src="{% static 'butterflies/js/searchable-dropdowns.js' %}"></script>
    </div>
    
    {# Render fields based on the form type - specimen form with categories #}
    {% if form|stringformat:"s"|lower|contains:"specimenform" or form.instance|stringformat:"s"|lower|contains:"specimen" or model_name == "Specimen" %}
        {# Specimen form #}
        
        {# CATEGORY 1: RECORD-LEVEL #}
        <div class="category-section">
            <div class="category-title">
                <span>1. Record-level</span>
                <button type="button" class="category-toggle" onclick="toggleSection(this)">−</button>
            </div>
            <div class="category-content">
                {# 1. modified field #}
                {% if form.instance %}
                {% if form.instance.modified %}
                    <div class="history-section">
                        <strong>Modified History:</strong><br>
                        <span style="white-space: pre-line;">{{ form.instance.modified }}</span>
                    </div>
                {% endif %}
                <div class="field-section">
                    <div>
                        <label>1. Modified</label>
                        <div class="flex-container">
                            <span class="date-container">
                                {{ form.mod_day|attr:"data-field-type:day,data-label:day" }} 
                                {{ form.mod_month|attr:"data-field-type:month,data-label:month" }} 
                                {{ form.mod_year|attr:"data-field-type:year,data-label:year" }}
                            </span>
                            <span class="initials-container">
                                {{ form.mod_initials|attr:"data-field-type:initials,data-label:initials" }}
                            </span>
                            <span class="description-container">
                                {{ form.mod_description }}
                            </span>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        
        {# CATEGORY 2: LOCATION #}
        <div class="category-section">
            <div class="category-title">
                <span>2. Location</span>
                <button type="button" class="category-toggle" onclick="toggleSection(this)">−</button>
            </div>
            <div class="category-content">
                <div class="field-grid">
                    {# 2. locality field #}
                    <div>
                        <label for="{{ form.locality.id_for_label }}">2. Locality:</label>
                        {{ form.locality|attr:"data-field-type:locality,data-label:locality" }}
                        {% if form.locality.help_text %}<small>{{ form.locality.help_text }}</small>{% endif %}
                        {% for error in form.locality.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 3. decimalLatitude field #}
                    <div>
                        <label for="{{ form.decimalLatitude.id_for_label }}">3. Decimal Latitude:</label>
                        {{ form.decimalLatitude|attr:"data-field-type:coordinate,data-label:latitude" }}
                        {% if form.decimalLatitude.help_text %}<small>{{ form.decimalLatitude.help_text }}</small>{% endif %}
                        {% for error in form.decimalLatitude.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 4. decimalLongitude field #}
                    <div>
                        <label for="{{ form.decimalLongitude.id_for_label }}">4. Decimal Longitude:</label>
                        {{ form.decimalLongitude|attr:"data-field-type:coordinate,data-label:longitude" }}
                        {% if form.decimalLongitude.help_text %}<small>{{ form.decimalLongitude.help_text }}</small>{% endif %}
                        {% for error in form.decimalLongitude.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 5. exact_loc field #}
                    <div>
                        <label for="{{ form.exact_loc.id_for_label }}">5. Exact Location:</label>
                        {{ form.exact_loc|attr:"data-field-type:boolean,data-label:exact location" }}
                        {% if form.exact_loc.help_text %}<small>{{ form.exact_loc.help_text }}</small>{% endif %}
                        {% for error in form.exact_loc.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 6. coordinateUncertaintyInMeters field #}
                    <div>
                        <label for="{{ form.coordinateUncertaintyInMeters.id_for_label }}">6. Coordinate Uncertainty In Meters:</label>
                        {{ form.coordinateUncertaintyInMeters|attr:"data-field-type:measurement,data-label:coordinate uncertainty" }}
                        {% if form.coordinateUncertaintyInMeters.help_text %}<small>{{ form.coordinateUncertaintyInMeters.help_text }}</small>{% endif %}
                        {% for error in form.coordinateUncertaintyInMeters.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 7. georeferencedBy field #}
                    <div>
                        <label for="{{ form.georeferencedBy.id_for_label }}">7. Georeferenced By:</label>
                        {{ form.georeferencedBy|attr:"data-field-type:person,data-label:georeferencer" }}
                        {% if form.georeferencedBy.help_text %}<small>{{ form.georeferencedBy.help_text }}</small>{% endif %}
                        {% for error in form.georeferencedBy.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 8. georeferencedDate field - custom date components #}
                    <div>
                        <label>8. Georeferenced Date:</label>
                        <div class="flex-container">
                            <span class="date-container">
                                {{ form.georef_day|attr:"data-field-type:day,data-label:day" }} 
                                {{ form.georef_month|attr:"data-field-type:month,data-label:month" }} 
                                {{ form.georef_year|attr:"data-field-type:year,data-label:year" }}
                            </span>
                        </div>
                        {% if form.georeferencedDate.help_text %}<small>{{ form.georeferencedDate.help_text }}</small>{% endif %}
                    </div>
                </div>
                
                {# 9. georeferenceProtocol field - direct input #}
                <div class="field-section">
                    <div class="text-field-container">
                        <label for="{{ form.georeferenceProtocol.id_for_label }}">9. Georeference Protocol</label>
                        {{ form.georeferenceProtocol|attr:"data-field-type:textarea,data-label:georeference protocol" }}
                        {% if form.georeferenceProtocol.errors %}<div class="error">{{ form.georeferenceProtocol.errors }}</div>{% endif %}
                    </div>
                </div>
                
                <div class="field-grid">
                    {# 10. minimumElevationInMeters field #}
                    <div>
                        <label for="{{ form.minimumElevationInMeters.id_for_label }}">10. Minimum Elevation In Meters:</label>
                        {{ form.minimumElevationInMeters|attr:"data-field-type:measurement,data-label:minimum elevation" }}
                        {% if form.minimumElevationInMeters.help_text %}<small>{{ form.minimumElevationInMeters.help_text }}</small>{% endif %}
                        {% for error in form.minimumElevationInMeters.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 11. maximumElevationInMeters field #}
                    <div>
                        <label for="{{ form.maximumElevationInMeters.id_for_label }}">11. Maximum Elevation In Meters:</label>
                        {{ form.maximumElevationInMeters|attr:"data-field-type:measurement,data-label:maximum elevation" }}
                        {% if form.maximumElevationInMeters.help_text %}<small>{{ form.maximumElevationInMeters.help_text }}</small>{% endif %}
                        {% for error in form.maximumElevationInMeters.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                </div>
            </div>
        </div>
        
        {# CATEGORY 3: OCCURRENCE #}
        <div class="category-section">
            <div class="category-title">
                <span>3. Occurrence</span>
                <button type="button" class="category-toggle" onclick="toggleSection(this)">−</button>
            </div>
            <div class="category-content">
                <div class="field-grid">
                    {# 12. specimenNumber field #}
                    <div>
                        <label for="{{ form.specimenNumber.id_for_label }}">12. Specimen Number:</label>
                        {{ form.specimenNumber|attr:"data-field-type:identifier,data-label:specimen number" }}
                        {% if form.specimenNumber.help_text %}<small>{{ form.specimenNumber.help_text }}</small>{% endif %}
                        {% for error in form.specimenNumber.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# catalogNumber field (not in numbered list but needed) #}
                    <div>
                        <label for="{{ form.catalogNumber.id_for_label }}">Catalog Number (auto-generated):</label>
                        <input type="text" value="auto generated" disabled style="background-color: #eee; color: #888; width: 300px;" placeholder="auto generated">
                        {% if form.catalogNumber.help_text %}<small>{{ form.catalogNumber.help_text }}</small>{% endif %}
                    </div>
                    
                    {# 13. recordedBy field #}
                    <div>
                        <label for="{{ form.recordedBy.id_for_label }}">13. Recorded By:</label>
                        {{ form.recordedBy|attr:"data-field-type:person,data-label:recorder" }}
                        {% if form.recordedBy.help_text %}<small>{{ form.recordedBy.help_text }}</small>{% endif %}
                        {% for error in form.recordedBy.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 14. sex field #}
                    <div>
                        <label for="{{ form.sex.id_for_label }}">14. Sex:</label>
                        {{ form.sex|attr:"data-field-type:sex,data-label:sex" }}
                        {% if form.sex.help_text %}<small>{{ form.sex.help_text }}</small>{% endif %}
                        {% for error in form.sex.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                </div>
                
                {# 15. behavior field - direct input #}
                <div class="field-section">
                    <div class="text-field-container">
                        <label for="{{ form.behavior.id_for_label }}">15. Behavior</label>
                        {{ form.behavior|attr:"data-field-type:textarea,data-label:behavior" }}
                        {% if form.behavior.errors %}<div class="error">{{ form.behavior.errors }}</div>{% endif %}
                    </div>
                </div>
                
                {# 16. occurrenceRemarks field - direct input #}
                <div class="field-section">
                    <div class="text-field-container">
                        <label for="{{ form.occurrenceRemarks.id_for_label }}">16. Occurrence Remarks</label>
                        {{ form.occurrenceRemarks|attr:"data-field-type:textarea,data-label:occurrence remarks" }}
                        {% if form.occurrenceRemarks.errors %}<div class="error">{{ form.occurrenceRemarks.errors }}</div>{% endif %}
                    </div>
                </div>
                
                {# 17. disposition field - append-only #}
                {% if form.instance.disposition %}
                    <div class="history-section">
                        <strong>17. Disposition History:</strong><br>
                        <span style="white-space: pre-line;">{{ form.instance.disposition }}</span>
                    </div>
                {% endif %}
                <div class="field-section">
                    <div>
                        <label>17. Disposition Entry</label>
                        <div class="flex-container">
                            <span class="date-container">
                                {{ form.disp_day|attr:"data-field-type:day,data-label:day" }} 
                                {{ form.disp_month|attr:"data-field-type:month,data-label:month" }} 
                                {{ form.disp_year|attr:"data-field-type:year,data-label:year" }}
                            </span>
                            <span class="initials-container">
                                {{ form.disp_initials|attr:"data-field-type:initials,data-label:initials" }}
                            </span>
                            <span class="description-container">
                                {{ form.disp_description|attr:"data-field-type:description,data-label:disposition description" }}
                            </span>
                        </div>
                    </div>
                </div>
                
                {# Extra field not in the numbered list #}
                <div class="field-grid">
                    <div>
                        <label for="{{ form.uploaded_iNaturalist.id_for_label }}">Uploaded to iNaturalist:</label>
                        {{ form.uploaded_iNaturalist|attr:"data-field-type:boolean,data-label:iNaturalist upload" }}
                        {% if form.uploaded_iNaturalist.help_text %}<small>{{ form.uploaded_iNaturalist.help_text }}</small>{% endif %}
                        {% for error in form.uploaded_iNaturalist.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                </div>
            </div>
        </div>
        
        {# CATEGORY 4: EVENT #}
        <div class="category-section">
            <div class="category-title">
                <span>4. Event</span>
                <button type="button" class="category-toggle" onclick="toggleSection(this)">−</button>
            </div>
            <div class="category-content">
                <div class="field-grid">
                    {# 18. year field #}
                    <div>
                        <label for="{{ form.year.id_for_label }}">18. Year:</label>
                        {{ form.year|attr:"data-field-type:year,data-label:year" }}
                        {% if form.year.help_text %}<small>{{ form.year.help_text }}</small>{% endif %}
                        {% for error in form.year.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 19. month field #}
                    <div>
                        <label for="{{ form.month.id_for_label }}">19. Month:</label>
                        {{ form.month|attr:"data-field-type:month,data-label:month" }}
                        {% if form.month.help_text %}<small>{{ form.month.help_text }}</small>{% endif %}
                        {% for error in form.month.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 20. day field #}
                    <div>
                        <label for="{{ form.day.id_for_label }}">20. Day:</label>
                        {{ form.day|attr:"data-field-type:day,data-label:day" }}
                        {% if form.day.help_text %}<small>{{ form.day.help_text }}</small>{% endif %}
                        {% for error in form.day.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 21. eventTime field - using military time (24-hour format) #}
                    <div>
                        <label for="{{ form.eventTime.id_for_label }}">21. Event Time (24h):</label>
                        {{ form.eventTime|attr:"data-field-type:time,data-label:event time,data-time-format:24h" }}
                        {% if form.eventTime.help_text %}<small>{{ form.eventTime.help_text }}</small>{% endif %}
                        {% if not form.eventTime.help_text %}<small>Use 24-hour format (e.g., 14:30 for 2:30 PM)</small>{% endif %}
                        {% for error in form.eventTime.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                </div>
                
                {# Event Date components - needed for backend processing #}
                <div style="display: none;">
                    {{ form.event_day|attr:"data-field-type:day,data-label:event day" }}
                    {{ form.event_month|attr:"data-field-type:month,data-label:event month" }}
                    {{ form.event_year|attr:"data-field-type:year,data-label:event year" }}
                </div>
                
                {# 22. habitatNotes field - direct input #}
                <div class="field-section">
                    <div class="text-field-container">
                        <label for="{{ form.habitatNotes.id_for_label }}">22. Habitat Notes</label>
                        {{ form.habitatNotes|attr:"data-field-type:textarea,data-label:habitat notes" }}
                        {% if form.habitatNotes.errors %}<div class="error">{{ form.habitatNotes.errors }}</div>{% endif %}
                    </div>
                </div>
                
                {# 23. samplingProtocol field - direct input #}
                <div class="field-section">
                    <div class="text-field-container">
                        <label for="{{ form.samplingProtocol.id_for_label }}">23. Sampling Protocol</label>
                        {{ form.samplingProtocol|attr:"data-field-type:textarea,data-label:sampling protocol" }}
                        {% if form.samplingProtocol.errors %}<div class="error">{{ form.samplingProtocol.errors }}</div>{% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        {# CATEGORY 5: TAXON #}
        <div class="category-section">
            <div class="category-title">
                <span>5. Taxon</span>
                <button type="button" class="category-toggle" onclick="toggleSection(this)">−</button>
            </div>
            <div class="category-content">
                <div class="field-grid">
                    {# 24. family field #}
                    <div>
                        <label for="{{ form.family.id_for_label }}">24. Family:</label>
                        {{ form.family|attr:"data-field-type:taxonomy,data-taxonomy-level:family,data-label:family" }}
                        {% if form.family.help_text %}<small>{{ form.family.help_text }}</small>{% endif %}
                        {% for error in form.family.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 25. subfamily field #}
                    <div>
                        <label for="{{ form.subfamily.id_for_label }}">25. Subfamily:</label>
                        {{ form.subfamily|attr:"data-field-type:taxonomy,data-taxonomy-level:subfamily,data-label:subfamily" }}
                        {% if form.subfamily.help_text %}<small>{{ form.subfamily.help_text }}</small>{% endif %}
                        {% for error in form.subfamily.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 26. tribe field #}
                    <div>
                        <label for="{{ form.tribe.id_for_label }}">26. Tribe:</label>
                        {{ form.tribe|attr:"data-field-type:taxonomy,data-taxonomy-level:tribe,data-label:tribe" }}
                        {% if form.tribe.help_text %}<small>{{ form.tribe.help_text }}</small>{% endif %}
                        {% for error in form.tribe.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 27. subtribe field #}
                    <div>
                        <label for="{{ form.subtribe.id_for_label }}">27. Subtribe:</label>
                        {{ form.subtribe|attr:"data-field-type:taxonomy,data-taxonomy-level:subtribe,data-label:subtribe" }}
                        {% if form.subtribe.help_text %}<small>{{ form.subtribe.help_text }}</small>{% endif %}
                        {% for error in form.subtribe.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 28. genus field #}
                    <div>
                        <label for="{{ form.genus.id_for_label }}">28. Genus:</label>
                        {{ form.genus|attr:"data-field-type:taxonomy,data-taxonomy-level:genus,data-label:genus" }}
                        {% if form.genus.help_text %}<small>{{ form.genus.help_text }}</small>{% endif %}
                        {% for error in form.genus.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 29. specificEpithet field #}
                    <div>
                        <label for="{{ form.specificEpithet.id_for_label }}">29. Specific Epithet:</label>
                        {{ form.specificEpithet|attr:"data-field-type:taxonomy,data-taxonomy-level:specific-epithet,data-label:specific epithet" }}
                        {% if form.specificEpithet.help_text %}<small>{{ form.specificEpithet.help_text }}</small>{% endif %}
                        {% for error in form.specificEpithet.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 30. infraspecificEpithet field #}
                    <div>
                        <label for="{{ form.infraspecificEpithet.id_for_label }}">30. Infraspecific Epithet:</label>
                        {{ form.infraspecificEpithet|attr:"data-field-type:taxonomy,data-taxonomy-level:infraspecific-epithet,data-label:infraspecific epithet" }}
                        {% if form.infraspecificEpithet.help_text %}<small>{{ form.infraspecificEpithet.help_text }}</small>{% endif %}
                        {% for error in form.infraspecificEpithet.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                </div>
            </div>
        </div>
        
        {# CATEGORY 6: IDENTIFICATION #}
        <div class="category-section">
            <div class="category-title">
                <span>6. Identification</span>
                <button type="button" class="category-toggle" onclick="toggleSection(this)">−</button>
            </div>
            <div class="category-content">
                <div class="field-grid">
                    {# 31. identifiedBy field #}
                    <div>
                        <label for="{{ form.identifiedBy.id_for_label }}">31. Identified By:</label>
                        {{ form.identifiedBy|attr:"data-field-type:person,data-label:identifier" }}
                        {% if form.identifiedBy.help_text %}<small>{{ form.identifiedBy.help_text }}</small>{% endif %}
                        {% for error in form.identifiedBy.errors %}<div class="error">{{ error }}</div>{% endfor %}
                    </div>
                    
                    {# 32. dateIdentified fields (split into day/month/year) #}
                    <div>
                        <label>32. Date Identified:</label>
                        <div class="row">
                            <div class="col-4">
                                {{ form.dateIdentified_day|attr:"data-field-type:day,data-label:date identified day" }}
                                {% for error in form.dateIdentified_day.errors %}<div class="error">{{ error }}</div>{% endfor %}
                            </div>
                            <div class="col-4">
                                {{ form.dateIdentified_month|attr:"data-field-type:month,data-label:date identified month" }}
                                {% for error in form.dateIdentified_month.errors %}<div class="error">{{ error }}</div>{% endfor %}
                            </div>
                            <div class="col-4">
                                {{ form.dateIdentified_year|attr:"data-field-type:year,data-label:date identified year" }}
                                {% for error in form.dateIdentified_year.errors %}<div class="error">{{ error }}</div>{% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                
                {# 33. identificationReferences field - direct input #}
                <div class="field-section">
                    <div class="text-field-container">
                        <label for="{{ form.identificationReferences.id_for_label }}">33. Identification References</label>
                        {{ form.identificationReferences|attr:"data-field-type:textarea,data-label:identification references" }}
                        {% if form.identificationReferences.errors %}<div class="error">{{ form.identificationReferences.errors }}</div>{% endif %}
                    </div>
                </div>
                
                {# 34. identificationRemarks field - direct input #}
                <div class="field-section">
                    <div class="text-field-container">
                        <label for="{{ form.identificationRemarks.id_for_label }}">34. Identification Remarks</label>
                        {{ form.identificationRemarks|attr:"data-field-type:textarea,data-label:identification remarks" }}
                        {% if form.identificationRemarks.errors %}<div class="error">{{ form.identificationRemarks.errors }}</div>{% endif %}
                    </div>
                </div>
            </div>
        </div>
        
    {% else %}
        {# For Locality, Initials, and other simpler forms - render similar to original form #}
        {% for field in form %}
        <div>
            <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
            {% if field|stringformat:"s"|contains:"select" %}
                {# Apply data attributes to select fields to improve dropdown handling #}
                {% if model_name %}
                    {{ field|attr:"data-field-type:field,data-model-type:"|add:model_name|add:",data-label:"|add:field.label|lower }}
                {% else %}
                    {{ field|attr:"data-field-type:field,data-label:"|add:field.label|lower }}
                {% endif %}
            {% else %}
                {{ field }}
            {% endif %}
            {% if field.help_text %}<small>{{ field.help_text }}</small>{% endif %}
            {% if field.errors %}<div class="field-error">{{ field.errors|first }}</div>{% endif %}
        </div>
        {% endfor %}
    {% endif %}
    
    <button type="submit">Save</button>
</form>
<br/>

<!-- JavaScript for toggling sections -->
<script>
    function toggleSection(button) {
        const content = button.closest('.category-title').nextElementSibling;
        if (content.style.display === 'none') {
            content.style.display = 'block';
            button.textContent = '−'; // Minus sign
        } else {
            content.style.display = 'none';
            button.textContent = '+'; // Plus sign
        }
    }
    
    // Initialize select2 for dropdowns if available
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof initSearchableDropdowns === 'function') {
            initSearchableDropdowns();
        }
    });
</script>

<!-- Enhanced CSS for consistent form styling -->
<style>
    /* Base styles for all form elements */
    input, select, .searchable-input {
        padding: 6px;
        border: 1px solid #6b8e23; /* Olive green border for inputs */
        border-radius: 4px;
        box-sizing: border-box;
    }
    
    input:focus, select:focus, .searchable-input:focus {
        border-color: #4682b4; /* Steel blue when focused */
        outline: none;
        box-shadow: 0 0 5px rgba(70, 130, 180, 0.5);
    }
    
    /* Searchable input specific styles */
    input.searchable-input {
        min-width: 150px;
        cursor: pointer;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23555555' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: calc(100% - 8px) center;
        padding-right: 24px;
        transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    /* Form container spacing */
    form > div {
        margin-bottom: 15px;
    }
    
    /* Help text styling */
    small {
        display: block;
        margin-top: 4px;
        color: #666;
    }
    
    /* Submit button styling */
    button[type="submit"] {
        background-color: #6b8e23;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        margin-top: 20px;
    }
    
    button[type="submit"]:hover {
        background-color: #556b2f;
    }
</style>
